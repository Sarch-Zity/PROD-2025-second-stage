#  Задача 10 | Оплата – логика валидации

[⬅️ назад](../README.md)

## ТЗ

### Валидация данных банковской карты

Необходимо реализовать логику валидации введенных данных банковской карты.

1. Валидация номера карты
   1. Номер карты должен состоять из 16 цифр, разделенных пробелами на группы по 4 цифры
   2. Номер карты должен содержать только цифры и пробелы
2. Валидация срока действия карты
   1. Срок действия карты должен состоять из 5 символов и быть в формате `mm/YY`
   2. Месяц должен быть в диапазоне от 1 до 12
   3. Год должен быть в диапазоне от 00 до 99
   4. Срок действия карты должен быть больше текущей даты. Считаем, что на текущий месяц карта еще действительна
3. Валидация CVV
   1. CVV должен состоять из 3 символов
   2. CVV должен содержать только цифры

Если пользователь еще не полностью ввел данные в поле ввода, то сообщение об ошибке не должно отображаться, но оплата должна быть недоступна. Валидация должна происходить только после полного ввода данных в поле ввода. Например, при вводе номера карты `1234 567` сообщение об ошибке не должно отображаться, но оплата должна быть недоступна. После ввода номера карты `1234 5678 1234 5678` сообщение об ошибке не должно быть. 

За вадилацию данных отвечает `PaymentCardValidateUseCase`. Внутри есть методы, в которых необходимо реализовать вышеописанную логику:
1. `PaymentCardValidateUseCase.validateCardNumber(paymentState: PaymentState, cardNumber: String): PaymentState` - метод для валидации номера карты
2. `PaymentCardValidateUseCase.validateCardDate(paymentState: PaymentState, cardDate: String, currentYear: Int, currentMonth: Int): PaymentState` - метод для валидации срока действия карты
3. `PaymentCardValidateUseCase.validateCardCvv(paymentState: PaymentState, cardCvv: String): PaymentState` - метод для валидации CVV

Каждый метод на вход получает текущее состояние платежа `PaymentState` и данные для валидации. В конце должен возвращать новое состояние платежа `PaymentState`.

По итогам проверки данных флагам нужно установить значение `true`, если проверка прошла успешно, иначе `false`:
* `isCardNumberValid` - для номера карты
* `isCardDateValid` - для срока действия карты
* `isCardCvvValid` - для CVV
* `isPaymentAvailable` - если все данные валидны, то устанавливаем `true`, иначе `false`

Также в `PaymentState` необходимо поддерживать в актуальном состоянии, обновляя данные внутри после ввода и валидации.

### Оплата товаров

Также необходимо реализовать `PayUseCase`, который отвечает за передачу данных в сервис для оплаты товаров.

Для оплаты необходимо внутри реализации `PayUseCase` вызвать метод `payRepository.pay()`, передав туда:
1. `CardNumber` - введенный номер карты
2. `CardDate` - введенный срок действия карты
3. `CardCvv` - введенный CVV
4. `GoodsList` - список пар товар-количество

## Ожидаемое решение

* Необходимо реализовать логику валидации внутри класса `PaymentCardValidateUseCaseImpl`, который отвечает за валидацию данных банковской карты.
* Логика валидации должна соответствовать описанной в ТЗ.
* `PaymentCardValidateUseCaseImpl` должен реализовывать интерфейс `PaymentCardValidateUseCase`.
* Необходимо реализовать логику оплаты внутри класса `PayUseCaseImpl`, который отвечает за передачу данных в сервис для оплаты товаров.
* `PayUseCaseImpl` должен реализовывать интерфейс `PayUseCase`.
